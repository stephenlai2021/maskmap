(self["webpackChunkmaskmap"]=self["webpackChunkmaskmap"]||[]).push([[89],{6089:(e,a,t)=>{"use strict";t.r(a),t.d(a,{default:()=>y});var n=t(3673),o=t(8880);const l=(0,n.HX)("data-v-a7010490");(0,n.dD)("data-v-a7010490");const s=(0,n.Wm)("b",null,"Install Maskmap ?",-1);(0,n.Cn)();const r=l(((e,a,t,r,p,i)=>{const c=(0,n.up)("q-icon"),u=(0,n.up)("q-avatar"),d=(0,n.up)("q-btn"),m=(0,n.up)("q-banner");return(0,n.wg)(),(0,n.j4)("div",null,[(0,n.Wm)(c,{name:"img:/icons/gps.png",class:"location",onClick:r.getUserLocation},null,8,["onClick"]),(0,n.Wm)("div",{id:"map",style:{left:r.store.state.drawer?"150px":"0px"}},null,4),(0,n.Wm)(o.uT,{appear:"","enter-active-class":"animated slideInUp","leave-active-class":"animated slideOutDown"},{default:l((()=>[r.showAppInstallBanner?((0,n.wg)(),(0,n.j4)(m,{key:0,"inline-actions":"",class:"text-white"},{avatar:l((()=>[(0,n.Wm)(u,{size:"md",color:"red","text-color":"white",icon:"directions"})])),action:l((()=>[(0,n.Wm)(d,{onClick:r.installApp,flat:"",label:"Yes",dense:"",class:"q-px-sm"},null,8,["onClick"]),(0,n.Wm)(d,{onClick:a[1]||(a[1]=e=>r.showAppInstallBanner=!1),flat:"",label:"Later",dense:"",class:"q-px-sm"}),(0,n.Wm)(d,{onClick:r.neverShowAppInstallBanner,flat:"",label:"Never",dense:"",class:"q-px-sm"},null,8,["onClick"])])),default:l((()=>[s])),_:1})):(0,n.kq)("",!0)])),_:1})])}));t(71);var p=t(8825),i=t(1959);let c;const u={props:["item"],setup(){const e=(0,n.f3)("store"),a=(0,p.Z)(),t=(0,i.iH)(!1),o=(0,i.iH)(null),l=(0,i.iH)(null),s=(0,i.iH)(null),r=(0,i.iH)(null),u=(0,i.iH)(null),d=(0,i.iH)(null),m=(0,i.iH)(null),v=(0,i.iH)(null),h=(0,i.iH)(null),g=(0,i.iH)(7),k=(0,i.iH)(null),x=(0,i.iH)(0),y=(0,i.iH)(0),w=()=>{console.log("user location: ",x.value,y.value),o.value.setZoom(18),o.value.maxZoom=18,o.value.panTo([x.value,y.value]),l.value.bindPopup("您在這裡").openPopup()},b=()=>{o.value.setZoom(18),o.value.maxZoom=18,o.value.panTo([e.state.lat,e.state.lng]),u.value=L.marker([e.state.lat,e.state.lng]).addTo(o.value).bindPopup(`\n            <q-card-section>\n              <div class="text-h6 text-cyan-8">\n                ${e.state.pharmacy.properties.name}\n              </div>\n              <div class="text-primary">\n                ${e.state.pharmacy.properties.address} (${e.state.pharmacy.properties.cunli})\n              </div>\n              <div class="text-primary q-mt-sm">\n                ${e.state.pharmacy.properties.phone}\n              </div>\n            </q-card-section>\n\n            <div class="q-mt-md flex justify-around q-py-sm rounded-borders">\n              <span class="text-cyan-8 text-h6">成人 ${e.state.pharmacy.properties.mask_adult}</span>\n              <span class="text-cyan-8 text-h6">兒童 ${e.state.pharmacy.properties.mask_child}</span>\n            </div>\n\n          `).openPopup()},f=()=>{k.value=L.control.zoom({position:"topright"}).addTo(o.value)},q=()=>{navigator.geolocation&&navigator.geolocation.getCurrentPosition((e=>{x.value=e.coords.latitude,y.value=e.coords.longitude,o.value=L.map("map",{center:[x.value,y.value],zoom:g.value,maxZoom:18,zoomControl:!1}),f(),C(),l.value=L.marker([x.value,y.value],{icon:d.value}).addTo(o.value).bindPopup("您的位置").openPopup(),A(),L.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",{attribution:'© <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a>         contributors',maxZoom:18}).addTo(o.value)}))},A=()=>{s.value=L.markerClusterGroup(),e.state.api.map((a=>{if(a.properties.mask_adult<=200||a.properties.mask_child<=200?h.value=v.value:h.value=m.value,a.properties.county===e.state.selectedCity&&a.properties.town===e.state.selectedArea)return s.value.addLayer(r.value=L.marker([a.geometry.coordinates[1],a.geometry.coordinates[0]],{icon:h.value}).openPopup().bindPopup(`\n              <q-card-section>\n                <div class="text-h6 text-cyan-8">\n                  ${a.properties.name}\n                </div>\n                <div class="text-subtitle2 text-primary">\n                  ${a.properties.address} (${a.properties.cunli})\n                </div>\n                <div class="text-subtitle2 text-primary q-mt-sm">\n                  ${a.properties.phone}\n                </div>\n              </q-card-section>\n\n              <div class="q-mt-md flex justify-around q-py-sm rounded-borders">\n                <span class="text-cyan-8 text-h6">成人 ${a.properties.mask_adult}</span>\n                <span class="text-cyan-8 text-h6">兒童 ${a.properties.mask_child}</span>\n              </div>\n\n            `))})),o.value.addLayer(s.value)},C=()=>{d.value=new L.Icon({iconUrl:"/marker/marker-icon-2x-red.png",shadowUrl:"/marker/marker-shadow.png",iconSize:[25,41],iconAnchor:[12,41],popupAnchor:[1,-34],shadowSize:[41,41]}),m.value=new L.Icon({iconUrl:"/marker/marker-icon-2x-green.png",shadowUrl:"/marker/marker-shadow.png",iconSize:[25,41],iconAnchor:[12,41],popupAnchor:[1,-34],shadowSize:[41,41]}),v.value=new L.Icon({iconUrl:"/marker/marker-icon-2x-grey.png",shadowUrl:"marker/marker-shadow.png",iconSize:[25,41],iconAnchor:[12,41],popupAnchor:[1,-34],shadowSize:[41,41]})},H=()=>{o.value.removeLayer(s.value),o.value.addLayer(l.value),A()};(0,n.YP)((()=>[e.state.selectedCity,e.state.selectedArea]),(([e,a],[t,n])=>{console.log(`您選擇了: ${e}${a}`),H()})),(0,n.YP)((()=>[e.state.lat,e.state.lng]),(([e,a],[t,n])=>{console.log("新座標: ",e,a),H(),b()}));const I=()=>{t.value=!1,a.localStorage.set("neverShowAppInstallBanner",!0)},S=()=>{t.value=!1,c.prompt(),c.userChoice.then((e=>{"accepted"===e.outcome?(console.log("User accepted the install prompt"),I()):console.log("User dismissed the install prompt")}))};return(0,n.bv)((()=>{q();let e=a.localStorage.getItem("neverShowAppInstallBanner");e||window.addEventListener("beforeinstallprompt",(e=>{e.preventDefault(),c=e,setTimeout((()=>{t.value=!0}),2e3)}))})),{store:e,showAppInstallBanner:t,Goto:b,getUserLocation:w,installApp:S,neverShowAppInstallBanner:I}}};var d=t(4554),m=t(5607),v=t(5096),h=t(3187),g=t(5589),k=t(7518),x=t.n(k);u.render=r,u.__scopeId="data-v-a7010490";const y=u;x()(u,"components",{QIcon:d.Z,QBanner:m.Z,QAvatar:v.Z,QBtn:h.Z,QCardSection:g.Z})}}]);